notifications:
  email: false

Authorization: token

# if: tag IS present

os: linux
language: minimal
services:
  - docker

env:
  global:
    # SOMEVAR
    - secure: "N1oM4gdmALjZiagx9ryZ4w8GF9h4iCWniztw5YEdRzFnJOtXS/LTgEcm2Zo/IEUYTrrGZWXtj80Coy2qlcrwccKXMw5msQh9APPjfvhA2zwbZRAgyZTsnKUuetA4mWpieGSMmFAA9GQRDe64d7YUBw/PRSDKHFguBxQBvltcQQi2HXosuv9cCdXnhaRTvzszDPQh1qxFxqbh8ELg4amFHbJASJkej0tl0i6Tn2XtrggdbFXE77SiL0pw7ewWsZjx5LSvACkaKIIvApoE71eton02efKq7V1oXkjhHyPz+t3G7pVOJmP6+eV+VdrSnT7xzybIJDiU2wEzn4Zl4eVOFtJdXqif/m0GFJUDO7gO6V0IpQi9Db2A9xTP6Lh9swQCfBoCH54lR61oOjImG6vsig47zwyqQ1nT9gjDmg8hXs1dsoo8XOYV240kTjix66Ze8hb80xOXJJYuU+Nd825GizXeJztj7wrSdXOLMOGYAV0x4J6SUp9v/BmTXokJU5EsKToi8HJsH7jy6KUDMwHT6bWS5ogpbRmzUTSlj6AvJvhAl68PWqTkgF+rJ72gqaxKOuWy9oGNR2587JHSfWDHD0yLup9mnD2jWoGYDFYEaRmONyrGxzyiiVtdnCYBmv2pFdm9xjyn9nYc9r0XfqOz9KUNvu3BaZ6wAHEG2q2U8zs="
  jobs:
    - DOCKER_IMAGE=quay.io/pypa/manylinux1_x86_64
    - DOCKER_IMAGE=quay.io/pypa/manylinux1_i686
    - DOCKER_IMAGE=quay.io/pypa/manylinux2010_x86_64
    - DOCKER_IMAGE=quay.io/pypa/manylinux2010_i686
    - DOCKER_IMAGE=quay.io/pypa/manylinux2014_x86_64
    - DOCKER_IMAGE=quay.io/pypa/manylinux2014_i686

install:
  - docker pull $DOCKER_IMAGE
script:
  - echo "Current working directory:" $PWD
  - ./pydave/twine-upload.sh
  - docker run --rm -e MANYLINUX=yes -v `pwd`:/io -w /io/pydave $DOCKER_IMAGE /io/pydave/build-wheels.sh
  - ls pydave/wheelhouse/

jobs:
  include:
    - name: MacOS build
      os: osx
      language: minimal
      env:
        -
      install:
        - pip3 install delocate
        - ln -f -s $(which python3) $(which python) # force re-link python to python3
      script:
        - cd pydave; echo "Current working directory:" $PWD;
        - ./twine-upload.sh
        - ./build-wheels.sh
        - ls wheelhouse/
